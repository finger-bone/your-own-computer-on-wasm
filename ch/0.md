# 前言

本系列将编写一个简化的计算机系统，来帮助理解计算机系统的工作原理。

编写本系列的动机是我在学习计算机系统时，大部分教材都会以verilog或者VDHL等硬件描述语言来实现一个计算机系统。然而，我的专业是SE，更熟悉纯软件的开发。此外，网上的大部分以纯软件实现的模拟器都是基于某个现有的计算机系统，如x86、ARM等，然而，即使是实现现实中很简单的计算机系统，也会有很多细节需要处理，这会让初学者很难理解。我曾经学习过一个实现riscv的模拟器，但在实现各种机制的过程中，代码量增加的速度远远超过了我对计算机系统的理解，使我半途而废了。

此外，即使是实现一个很简单的Gameboy等计算机系统，很多在现实中为了节省位的设计也会使得代码难以理解——然而，我并不是且不计划成为一个硬件工程师，我只是想更好地理解计算机系统的工作原理。

因此，本系列设计的系统的宗旨是浪费。例如，所有指令都是64位，且都遵循相同的结构。现实中的指令集通常都是32位乃至16位（arm thumb），即使是在64位系统中。这样做的目的是为了简化指令解码的过程，使得我们能更好地理解计算机系统的工作原理。

在我写下前言时，我已经实现了计算机系统的模拟器和汇编器，目前的代码量也没有超过1000行。且只使用了几天的时间。这样的简化可以更快地理解计算机系统的工作原理，实现一个可以运行的虚拟机，而不是被细节淹没。

本计算机系统分为两部分：核心系统(Core System)，包括CPU与内存；外设(Peripheral)，包括输入设备、输出设备、存储设备等。外设将全部使用简化的中断机制与内存映射机制来实现。

我们将使用Rust来编写，目的是编译到wasm，以便在浏览器中运行，并方便可视化。如果你不想追求一个可视化的界面，你可以使用任何语言来实现这个计算机系统。然而，我不建议直接使用js（包括ts），~~因为我失败过一次了~~。因为js的Number类型过于模糊，可以是bigint，float64和int32，在进行位运算时会很麻烦。例如，位移运算符`<<`在js中是将操作数转换为int32，然后进行位移，这会导致负数的位移结果不符合预期。

如果不熟悉Rust也没关系，本文没有使用生命周期、trait、泛型等高级特性，只使用了基本的数据类型、结构体、枚举、函数等。如果你从来没学过Rust语言，只要有其它语言的编程基础，并简单了解一下Rust借用规则，你也能看懂本文，并用你熟悉的语言实现这个计算机系统。

[Github源码链接](https://github.com/proximal-phalanx/your-own-computer-on-wasm)